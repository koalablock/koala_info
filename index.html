<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>考拉信息站</title>

    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/bootstrap-table/1.10.0/bootstrap-table.css" rel="stylesheet" />
    <link href="css/default.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">考拉信息</a>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li class="active"><a href="#">币安币种信息 <span class="sr-only">(current)</span></a></li>
            </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <form id="searchForm"></form>

            <table id="table"
                   data-toggle="table"
                   data-ajax="ajaxRequest"
                   data-search="false"
                   data-side-pagination="server"
                   data-sort-name="diff"
                   data-sort-order="asc"
                   data-sort-stable="true"
                   data-pagination="false">
                <thead>
                <tr>
                    <th data-field="" data-formatter="idFormatter">序号</th>
                    <th data-field="symbol" >币名</th>
                    <th data-field="priceCny" >当前价格</th>
                    <th data-field="issuePriceCny" >发行价格</th>
                    <th data-field="diff" data-sortable="true" data-formatter="diffFormatter">至今涨幅</th>
                </tr>
                </thead>
            </table>

        </div> <!-- //.col-sm-9 -->
    </div> <!-- //.row -->
</div> <!-- //.container-fluid-->

<!--<iframe id="binancePrice" style="display: none" src="https://api.binance.com/api/v1/ticker/allPrices"></iframe>-->

<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap-table/1.10.0/bootstrap-table.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap-table/1.10.0/locale/bootstrap-table-zh-CN.min.js"></script>
<script type="text/javascript" src="https://unpkg.com/ccxt"></script>
<script>
    var binanceApi = 'https://api.binance.com/api/v1'
    var issuePrices = {'ETH': 0.308, 'NEO': 0.159, 'MCO': 2.88, 'WTC': 0.4, 'LRC': 0.053, 'QTUM': 0.2941, 'YOYO': 0.01, 'OMG': 0.24, 'ZRX': 0.048, 'STRAT': 0.0073, 'SNGLS': 0.015, 'KNC': 0.46, 'FUN': 0.007, 'SNM': 0.12, 'IOTA': 0.0004, 'LINK': 0.11, 'MDA': 1.0, 'MTL': 0.18, 'SUB': 0.0817, 'EOS': 0.99, 'SNT': 0.037, 'ENG': 0.6, 'DNT': 0.0187, 'AST': 0.24, 'ICN': 0.11, 'REQ': 0.0672, 'VIB': 0.1, 'TRX': 0.0015, 'POWR': 0.0838, 'ARK': 0.01, 'ENJ': 0.03, 'STORJ': 0.4097, 'KMD': 0.022, 'RCN': 0.0743, 'AMB': 0.29, 'BAT': 0.0364, 'BCPT': 0.31, 'ARN': 0.5, 'GVT': 1.0, 'CDT': 0.0356, 'GXS': 0.1159, 'POE': 0.0064, 'QSP': 0.072, 'BTS': 0.0103, 'TNT': 0.0716, 'FUEL': 0.1, 'MANA': 0.024, 'ADX': 0.25, 'ADA': 0.0026, 'PPT': 0.17, 'CMT': 0.0524, 'LEND': 0.0173, 'WABI': 0.25, 'TNB': 0.015, 'WAVES': 0.1884, 'GTO': 0.1, 'ICX': 0.12, 'OST': 0.0889, 'ELF': 0.099, 'AION': 1.0, 'NEBL': 0.17, 'BRD': 0.78, 'EDO': 2.58, 'WINGS': 0.0267, 'TRIG': 0.1, 'APPC': 0.27, 'VIBE': 0.01, 'RLC': 0.25, 'INS': 1.56, 'CHAT': 0.082, 'VIA': 0.037, 'BLZ': 0.12, 'AE': 0.27, 'NCASH': 0.01, 'POA': 0.0724, 'ZIL': 0.0081, 'ONT': 0.2, 'STORM': 0.0113, 'WPR': 0.125, 'QLC': 0.067, 'SYS': 0.001, 'GRS': 0.0043, 'CLOAK': 0.18, 'GNT': 0.01, 'LOOM': 0.0555, 'SKY': 0.1, 'CVC': 0.1, 'THETA': 0.15, 'IOTX': 0.01, 'QKC': 0.018, 'AGI': 0.1, 'SC': 0.0001, 'NPXS': 0.002, 'KEY': 0.015, 'NAS': 1.91, 'MFT': 0.003, 'DENT': 0.0006, 'VET': 0.0225, 'DOCK': 0.08, 'POLY': 0.7905};

    $.ajaxPrefilter(function(options) {
        if (options.crossDomain && jQuery.support.cors) {
            options.url = 'https://cors-anywhere.herokuapp.com/' + options.url;
        }
    });

    var $table = $('#table');

    var usdRate = 0, btcPrice = 0

    // your custom ajax request here
    function ajaxRequest(params) {
        // data you need
        // console.log(params.data);

        // 获取汇率

        $.get('http://hq.sinajs.cn/list=USDCNY', function (rates) {
            // for (var i = 0; i < rates.length; i++) {
            //     if (rates[i].symbol === 'CNY_USD') usdRate = rates[i].rate
            //     if (rates[i].symbol === 'BTCUSDT') btcPrice = rates[i].rate
            // }
            usdRate = parseFloat(rates.split(',')[1]).toFixed(2);

            // 获取btc价格
            $.get(binanceApi + '/ticker/24hr?symbol=BTCUSDT', function (ticker) {
                btcPrice = ticker.bidPrice

                // 获取当前价格
                $.get(binanceApi + '/ticker/allPrices', function (res) {
                    var coins = [];
                    for (var i = 0; i < res.length; i++) {
                        var item = res[i];
                        var symbolR = item.symbol;

                        if (symbolR === 'BTCUSDT') btcPrice = parseFloat(item.price)

                        if (symbolR.indexOf('BTC') <= 0) continue

                        var symbol = symbolR.split('BTC')[0]

                        if (symbol in issuePrices) {
                            var data = {
                                symbol: symbol,
                                price: parseFloat(item.price),
                                priceUsd: (parseFloat(item.price) * btcPrice).toFixed(4),
                                priceCny: (parseFloat(item.price) * btcPrice * usdRate).toFixed(4),
                                issuePriceUsd: issuePrices[symbol].toFixed(4),
                                issuePriceCny: (issuePrices[symbol] * usdRate).toFixed(4),
                                diff: parseFloat((parseFloat(item.price) * btcPrice / issuePrices[symbol]).toFixed(2))
                            };
                            coins.push(data);
                        }


                    }

                    try {
                        coins = coins.sort(function (a, b) {
                            var sort = params.data.sort;
                            if (params.data.order == 'asc') {
                                return a[sort] - b[sort];
                            } else {
                                return b[sort] - a[sort];
                            }

                        });
                    } catch (e) {
                        console.error(e);
                    }

                    var data = {rows: coins};
                    params.success(data);
                });


            });


        });


    }

    function idFormatter(value, item, index) {
        return index + 1;
    }

    function diffFormatter(value, n) {
        if (value > 1) {
            return '<span style="color: green">' + value + '</span>';
        } else if (value > 0) {
            return '<span style="color: red">' + value + '</span>';
        }
        return value;
    }


</script>
</body>
</html>