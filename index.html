<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>考拉信息站</title>

    <link href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.bootcss.com/bootstrap-table/1.10.0/bootstrap-table.css" rel="stylesheet" />
    <link href="css/default.css" rel="stylesheet">
    <link href="css/app.css" rel="stylesheet">
</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="#">考拉信息</a>
        </div>
    </div>
</nav>

<div class="container-fluid">
    <div class="row">
        <div class="col-sm-3 col-md-2 sidebar">
            <ul class="nav nav-sidebar">
                <li class="active"><a href="#">币安币种信息 <span class="sr-only">(current)</span></a></li>
            </ul>
        </div>
        <div class="col-sm-9 col-sm-offset-3 col-md-10 col-md-offset-2 main">
            <form id="searchForm"></form>

            <table id="table"
                   data-toggle="table"
                   data-ajax="ajaxRequest"
                   data-search="false"
                   data-side-pagination="server"
                   data-sort-name="diff"
                   data-sort-order="asc"
                   data-sort-stable="true"
                   data-pagination="false">
                <thead>
                <tr>
                    <th data-field="" data-formatter="idFormatter">序号</th>
                    <th data-field="symbol"  data-sortable="true" >币名</th>
                    <th data-field="diff" data-sortable="true" data-formatter="diffFormatter">众筹幅</th>
                    <th data-field="percent"  data-sortable="true" data-align="right" data-formatter="percentFormatter">24H</th>
                    <th data-field="quoteVolume"  data-sortable="true" data-align="right">成交</th>
                    <th data-field="issuePriceCny"  data-sortable="true" >发行价格</th>
                    <th data-field="priceCny"  data-sortable="true" >当前价格</th>


                </tr>
                </thead>
            </table>

        </div> <!-- //.col-sm-9 -->
    </div> <!-- //.row -->
</div> <!-- //.container-fluid-->

<!--<iframe id="binancePrice" style="display: none" src="https://api.binance.com/api/v1/ticker/allPrices"></iframe>-->

<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap-table/1.10.0/bootstrap-table.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap-table/1.10.0/locale/bootstrap-table-zh-CN.min.js"></script>
<!--<script type="text/javascript" src="https://unpkg.com/ccxt"></script>-->
<script>
    var binanceApi = 'https://api.binance.com/api/v1'
    var issuePrices = {'ETH': 0.308, 'EOS': 0.99, 'ADA': 0.0026, 'TRX': 0.0015, 'BNB': 0.1553, 'IOTA': 0.0004, 'NEO': 0.159, 'ONT': 0.2, 'VET': 0.0225, 'ZRX': 0.048, 'LSK': 0.0747, 'OMG': 0.24, 'QTUM': 0.2941, 'BTS': 0.0103, 'AE': 0.27, 'ZIL': 0.0081, 'NANO': 0.02, 'SC': 0.0001, 'ICX': 0.12, 'WAVES': 0.1884, 'BAT': 0.0364, 'NPXS': 0.002, 'GNT': 0.01, 'REP': 0.58, 'STRAT': 0.0073, 'SNT': 0.037, 'PPT': 0.17, 'KMD': 0.022, 'LINK': 0.11, 'WTC': 0.4, 'WAN': 0.34, 'IOST': 0.01, 'AION': 1.0, 'NAS': 1.91, 'GXS': 0.1159, 'LRC': 0.053, 'CMT': 0.0524, 'HC': 4.5, 'ELF': 0.099, 'LOOM': 0.0555, 'BNT': 3.86, 'DGD': 2.75, 'FUN': 0.007, 'ARK': 0.01, 'MANA': 0.024, 'BLZ': 0.12, 'MCO': 2.88, 'POWR': 0.0838, 'THETA': 0.15, 'POLY': 0.7905, 'QKC': 0.018, 'SYS': 0.001, 'KNC': 0.46, 'GVT': 1.0, 'STORJ': 0.4097, 'CVC': 0.1, 'ENG': 0.6, 'SUB': 0.0817, 'SALT': 0.94, 'RVN': 0.03, 'MDA': 1.0, 'GRS': 0.0043, 'ENJ': 0.03, 'DENT': 0.0006, 'SKY': 0.1, 'GTO': 0.1, 'STORM': 0.0113, 'BRD': 0.78, 'REQ': 0.0672, 'RLC': 0.25, 'EDO': 2.58, 'CND': 0.01, 'NEBL': 0.17, 'PAX': 1.0, 'NCASH': 0.01, 'RDN': 0.67, 'AGI': 0.1, 'MFT': 0.003, 'AMB': 0.29, 'DATA': 0.0615, 'POE': 0.0064, 'TNB': 0.015, 'QSP': 0.072, 'MTL': 0.18, 'IOTX': 0.01, 'GO': 0.0428, 'SNM': 0.12, 'MOD': 1.0, 'LEND': 0.0173, 'OST': 0.0889, 'POA': 0.0724, 'ADX': 0.25, 'DNT': 0.0187, 'KEY': 0.015, 'VIA': 0.037, 'INS': 1.56, 'VIBE': 0.01, 'SNGLS': 0.015, 'WINGS': 0.0267, 'RCN': 0.0743, 'WPR': 0.125, 'AST': 0.24, 'CLOAK': 0.18, 'QLC': 0.067, 'TNT': 0.0716, 'ARN': 0.5, 'CDT': 0.0356, 'WABI': 0.25, 'APPC': 0.27, 'FUEL': 0.1, 'YOYO': 0.01, 'LUN': 1.13, 'DOCK': 0.08, 'BCPT': 0.31, 'DLT': 0.32, 'EVX': 2.1, 'VIB': 0.1, 'MTH': 0.16, 'OAX': 0.45}

    $.ajaxPrefilter(function(options) {
        if (options.crossDomain && jQuery.support.cors) {
            options.url = 'https://cors-anywhere.herokuapp.com/' + options.url;
        }
    });

    var $table = $('#table');

    var usdRate = 0, btcPrice = 0

    // your custom ajax request here
    function ajaxRequest(params) {
        // data you need
        // console.log(params.data);

        // 获取汇率

        $.get('http://hq.sinajs.cn/list=USDCNY', function (rates) {
            // for (var i = 0; i < rates.length; i++) {
            //     if (rates[i].symbol === 'CNY_USD') usdRate = rates[i].rate
            //     if (rates[i].symbol === 'BTCUSDT') btcPrice = rates[i].rate
            // }
            usdRate = parseFloat(rates.split(',')[1]).toFixed(2);

            // 获取当前价格
            $.get('https://api.binance.com/api/v1/ticker/24hr', function (res) {
                var coins = [];
                // btc价格
                for (var i = 0; i < res.length; i++) {
                    var item = res[i];
                    if (item.symbol === 'BTCUSDT') btcPrice = parseFloat(item.lastPrice)
                }

                for (var i = 0; i < res.length; i++) {
                    var item = res[i];
                    var symbolR = item.symbol;
                    var price = item.lastPrice;

                    // if (symbolR === 'BTCUSDT') btcPrice = parseFloat(price)

                    if (symbolR.indexOf('BTC') <= 0) continue

                    var symbol = symbolR.split('BTC')[0]

                    if (symbol in issuePrices) {
                        var data = {
                            symbol: symbol,
                            quoteVolume: parseInt(item.quoteVolume),
                            price: parseFloat(price),
                            priceUsd: (parseFloat(price) * btcPrice).toFixed(4),
                            priceCny: (parseFloat(price) * btcPrice * usdRate).toFixed(4),
                            issuePriceUsd: issuePrices[symbol].toFixed(4),
                            issuePriceCny: (issuePrices[symbol] * usdRate).toFixed(4),
                            diff: parseFloat((parseFloat(price) * btcPrice / issuePrices[symbol]).toFixed(2)),
                            percent: parseFloat(item.priceChangePercent).toFixed(2)
                        };
                        coins.push(data);
                    }


                }

                try {
                    coins = coins.sort(function (a, b) {
                        var sort = params.data.sort;
                        if (params.data.order == 'asc') {
                            return a[sort] - b[sort];
                        } else {
                            return b[sort] - a[sort];
                        }

                    });
                } catch (e) {
                    console.error(e);
                }

                var data = {rows: coins};
                params.success(data);
            });


        });



    }

    function idFormatter(value, item, index) {
        return index + 1;
    }

    function diffFormatter(value, n) {
        if (value > 1) {
            return '<span style="color: green">' + value + '</span>';
        } else if (value > 0) {
            return '<span style="color: red">' + value + '</span>';
        }
        return value;
    }

    function percentFormatter(value, n) {
        percent = value + '%';
        if (value > 0) {
            return '<span style="color: green">' + percent + '</span>';
        } else {
            return '<span style="color: red">' + percent + '</span>';
        }
        return percent;
    }


</script>
</body>
</html>